<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Building an OCR Chat Bot with the Microsoft Bot Framework on my Mac</title>
  <meta name="description" content="Command Line Emulator for the Bot Framework - interacting with ocrbot on Shakespeare">

  <link rel="canonical" href="http://localhost:4000/notes_posts/2016/11/07/how-to-bot-on-mac.html">
  <link rel="alternate" type="application/rss+xml" title="Waterfalls of Data" href="http://localhost:4000/feed.xml" />

  <!-- Material Design Lite css Library -->
  <link rel="stylesheet" type="text/css" href="https://storage.googleapis.com/code.getmdl.io/1.0.0/material.indigo-pink.min.css">
  
  <!-- Material Design Fonts -->
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/icon?family=Material+Icons">

  <!-- Custom theme css -->
  <link rel="stylesheet" href="/css/main.css">
</head>


  <body>

    <!-- Start Layout -->
    
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
      <!-- search layout -->
<div class="super-search" id="js-search">
  <ul class="super-search__results" id="js-search__results"></ul>        
  <button class="mdl-button mdl-js-button mdl-button--fab mdl-button--colored super-search__close-btn" onclick="superSearch.toggle()">
    <i class="material-icons">close</i>
  </button>
</div>
<!-- /end search -->
        <header class="mdl-layout__header">

    <div class="mdl-layout__header-row">
      <!-- Title -->
      <span class="mdl-layout-title">Waterfalls of Data</span>
      <!-- Add spacer, to align navigation to the right -->
      <div class="mdl-layout-spacer"></div>
      

      <div class="mdl-textfield mdl-js-textfield mdl-textfield--expandable is-upgraded">
        <label class="mdl-button mdl-js-button mdl-button--icon" for="js-search__input">
          <i class="material-icons">search</i>
        </label>

        <div class="mdl-textfield__expandable-holder" >
          <input class="mdl-textfield__input super-search__input" type="text" id="js-search__input" />
        </div>
      </div>

      <button class="mdl-button mdl-js-button mdl-button--icon" id="menu-lower-left">
        <i class="material-icons">more_vert</i>
      </button>

      <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="menu-lower-left">
        
        <li><a href="www.myawesomelink.com" class="mdl-menu__item">Cool Option 1</a></li>
        
        <li><a href="www.myawesomelink.com" class="mdl-menu__item">Cool Option 2</a></li>
        
        <li><a href="www.myawesomelink.com" class="mdl-menu__item">Cool Option 3</a></li>
        
      </ul>
    </div>
  </header>

  <div class="mdl-layout__drawer">
    <span class="mdl-layout-title">Menu</span>
    <nav class="mdl-navigation">
    
      
      <a class="mdl-navigation__link" href="/about/">About</a>
      
    
      
    
      
    
      
    
    </nav>

  </div>


    

    <div class="post-ribbon"></div>
<main class="post-main mdl-layout__content">
  <div class="post-container mdl-grid">
    <div class="mdl-cell mdl-cell--2-col mdl-cell--hide-tablet mdl-cell--hide-phone"></div>
    <div class="post-section mdl-color--white mdl-shadow--4dp content mdl-color-text--grey-800 mdl-cell mdl-cell--8-col">
      <div class="mdl-color-text--grey-500">
      Nov 7, 2016 •  Notes_Posts  
      </div>
      <h3>Building an OCR Chat Bot with the Microsoft Bot Framework on my Mac</h3>
      <article class="post-content">
        <p><p><img src="/resources/images/ocrbot_local.png" alt="ocrbot local" /><br />
<strong>Command Line Emulator for the Bot Framework - interacting with ocrbot on Shakespeare</strong>
<br /><br /></p>

<p>UPDATE:  The Command Line Emulator has been replaced with a full-fledged emulator which is cross-platform (info and install <a href="https://github.com/Microsoft/BotFramework-Emulator">here</a>).</p>

<p><strong>tl;dr</strong>: I built a simple OCR bot using the Bot Framework (BF) from Microsoft and the Cognitive Services Computer Vision API.  I chose the Node.js Bot Builder SDK from BF.  I tested with the BF’s unix-compatible emulator (black box above).  It was nice and straightforward the whole way through.  All of the instructions are <a href="https://github.com/michhar/bot-education-ocrbot/blob/master/LabStart.md">here</a>, but feel free to keep reading.</p>

<p>There’s really almost too much to say about chat bots:  definitions, bot builders, history (<a href="http://venturebeat.com/2016/08/15/a-short-history-of-chatbots-and-artificial-intelligence/">more</a>), warnings and cautionary tales (<a href="http://venturebeat.com/2016/08/15/a-short-history-of-chatbots-and-artificial-intelligence/">more</a>), guidelines, delightful stories, sad stories, etc.  For our purposes, other than a few considerations, I’ll sum it up with: they’ve been around for decades and will be for many more.</p>

<p>However, let’s cover some vocabulary to start.</p>

<p>A blog post <a href="http://willschenk.com/bot-design-patterns/?imm_mid=0e50a2&amp;cmp=em-data-na-na-newsltr_20160622">here</a> details the different types of chat bots, progressing from simple to ones that can hold down a conversation.  These are the bot types discussed and an example to illustrate:</p>

<ol>
  <li>Notifier - sends a one-way message e.g. <em>ping me with today’s weather forecast at the start of the day (“push” bot i.e. bot initiates)</em></li>
  <li>Reactor - replies when I send a message, but does not remember anything <em>e.g. send me the weather forecast when I ask for it (“pull bot” i.e. I initiate), but don’t remember me or what I ask for</em></li>
  <li>Responder - replies and remembers me and my message history e.g. <em>send me today’s weather forecast, use my user name on this channel, and remember what cities I choose</em></li>
  <li>Conversationalist - replies, remembers me and my message history, knows what service I’m on, if there are others there, and when I come and go e.g. <em>send me today’s weather forecast, use my user name on this channel, remember what cities I choose, format it nicely for this channel, and if the conversation is old, archive it and send as email</em></li>
</ol>

<p>Bot builders lower the activation barrier for developing bots and the MS Bot Framework (BF) Bot Builder SDKs give us a wealth of methods for building dialog and user prompts, making the creation of effective waterfalls really easy.  Along with the SDKs, the BF provides free emulator tools, a Windows-compatible desktop app and a Mac OS X / Linux-compatible console app (more information on emulators <a href="https://docs.botframework.com/en-us/tools/bot-framework-emulator/#navtitle">here</a>).</p>

<p>I know you’ve been waiting to dive into the code, so let’s begin…</p>

<p>There are two choices on bot builder functions for testing locally.  We can use the <code class="highlighter-rouge">ConsoleConnector</code> which simply and directly allows us to run our Node.js code on the command line.  Using the bot builder SDK our code is pretty concise (see more examples on the Core Concepts page for the BF <a href="https://docs.botframework.com/en-us/node/builder/guides/core-concepts/#navtitle">here</a>):</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'botbuilder'</span><span class="p">);</span>

<span class="c1">// Create a bot and connect it to the console</span>
<span class="kd">var</span> <span class="nx">connector</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">builder</span><span class="p">.</span><span class="nx">ConsoleConnector</span><span class="p">().</span><span class="nx">listen</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">bot</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">builder</span><span class="p">.</span><span class="nx">UniversalBot</span><span class="p">(</span><span class="nx">connector</span><span class="p">);</span>
</code></pre>
</div>
<p><br /></p>

<p>Interacting with ocrbot could look like:</p>

<p><img src="/resources/images/ocrbot_console_connect.png" alt="console connector" /><br /></p>

<p>It’s simple, but we don’t get to see the actual JSON that gets passed to the bot and the JSON passed back.  If we want to be able to see the message and also write code that can be used for production later, the Bot Framework Emulator is the way to go.   Note, this is the beginning of my server.js Node.js file - see my <a href="https://github.com/michhar/bot-education-ocrbot">ocrbot github repo</a> for the complete project and code and the included <a href="https://github.com/michhar/bot-education-ocrbot/blob/master/LabStart.md">lab file</a> for more instructions on doing this at home.  We replace  <code class="highlighter-rouge">ConsoleConnector</code> with <code class="highlighter-rouge">ChatConnector</code>, for a full deployment-compatible setup, as follows:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">restify</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'restify'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'botbuilder'</span><span class="p">);</span>

<span class="c1">// Create bot</span>
<span class="kd">var</span> <span class="nx">connector</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">builder</span><span class="p">.</span><span class="nx">ChatConnector</span><span class="p">(</span><span class="nx">botConnectorOptions</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">bot</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">builder</span><span class="p">.</span><span class="nx">UniversalBot</span><span class="p">(</span><span class="nx">connector</span><span class="p">);</span>

<span class="c1">// Setup Restify Server</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">restify</span><span class="p">.</span><span class="nx">createServer</span><span class="p">();</span>

<span class="c1">// Handle Bot Framework messages</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">'/api/messages'</span><span class="p">,</span> <span class="nx">connector</span><span class="p">.</span><span class="nx">listen</span><span class="p">());</span>

<span class="c1">// Serve a static web page - for testing deployment</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="sr">/.*/</span><span class="p">,</span> <span class="nx">restify</span><span class="p">.</span><span class="nx">serveStatic</span><span class="p">({</span>
	<span class="s1">'directory'</span><span class="p">:</span> <span class="s1">'.'</span><span class="p">,</span>
	<span class="s1">'default'</span><span class="p">:</span> <span class="s1">'index.html'</span>
<span class="p">}));</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">port</span> <span class="o">||</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">3978</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'%s listening to %s'</span><span class="p">,</span> <span class="nx">server</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">server</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span> 
<span class="p">});</span>

</code></pre>
</div>
<p><br /></p>

<p>One of the major reasons I used github to host this project is that (and outlined in a later blog, TBD) it afforded me the ability to do a continuous deployment directly from the repo.  Any change I push up, immediately reflects in my bot on whichever channel I’m on - it was actually pretty astonishing to see a quick typo fix show up so immediately when chatting to my bot at the same time as pushing up the change.  But I’ll save this for the deployment article to come.</p>

<p>I’ve always been a fan of command terminals, so even on a Windows machine I’d probably choose to download and use the BF Command Terminal Emulator (download instructions are <a href="https://docs.botframework.com/en-us/tools/bot-framework-emulator/#mac-and-linux-support-using-command-line-emulator">here</a>).  Honestly, I enjoy the simplicity and control a command prompt affords.  And now I can develop bots in the <em>exact</em> same way agnostic of OS.</p>

<p>So, I decided to create a bot I could give image links to and if there was text in the picture it would reply with that text.  Pretty simple and straightforward since I knew about the free subscriptions to Microsoft Cognitive Services and in particular the Vision APIs.  I went to the Cognitive Services main page and clicked on My Account and signed up (or I could have signed up <a href="https://www.microsoft.com/cognitive-services/en-US/sign-up?ReturnUrl=/cognitive-services/en-us/subscriptions">this way</a> with MS, github, or LinkedIn accounts).  After that I had a secret key for the service.  Now to splice that into my bot.</p>

<p>So, I borrowed much of my code from Samuele Resca’s <a href="https://samueleresca.net/2016/10/build-universal-bot-using-nodejs/">blog post</a> (excellent blog, btw).  I placed these helper methods in with the server.js code above:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="c1">//=========================================================</span>
<span class="c1">// URL Helpers</span>
<span class="c1">//=========================================================</span>


<span class="kd">var</span> <span class="nx">extractUrl</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">_extractUrl</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">type</span> <span class="o">!==</span> <span class="s2">"message"</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">message</span><span class="p">.</span><span class="nx">attachments</span> <span class="o">!==</span> <span class="s2">"undefined"</span>
        <span class="o">&amp;&amp;</span> <span class="nx">message</span><span class="p">.</span><span class="nx">attachments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">message</span><span class="p">.</span><span class="nx">attachments</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">contentUrl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">message</span><span class="p">.</span><span class="nx">text</span> <span class="o">!==</span> <span class="s2">""</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_findUrl</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">text</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="s2">""</span><span class="p">;</span>
<span class="p">};</span>


<span class="kd">function</span> <span class="nx">_findUrl</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">source</span> <span class="o">=</span> <span class="p">(</span><span class="nx">text</span> <span class="o">||</span> <span class="s1">''</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">matchArray</span><span class="p">;</span>

    <span class="c1">// Regular expression to find FTP, HTTP(S) and email URLs.</span>
    <span class="kd">var</span> <span class="nx">regexToken</span> <span class="o">=</span> <span class="sr">/</span><span class="se">(((</span><span class="sr">http|https</span><span class="se">?)</span><span class="sr">:</span><span class="se">\/\/)[\-\w</span><span class="sr">@:%_</span><span class="se">\+</span><span class="sr">.~#?,&amp;</span><span class="se">\/\/</span><span class="sr">=</span><span class="se">]</span><span class="sr">+</span><span class="se">)</span><span class="sr">/g</span><span class="p">;</span>

    <span class="c1">// Iterate through any URLs in the text.</span>
    <span class="k">if</span> <span class="p">((</span><span class="nx">matchArray</span> <span class="o">=</span> <span class="nx">regexToken</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">source</span><span class="p">))</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">matchArray</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="k">return</span> <span class="nx">token</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="s2">""</span><span class="p">;</span>
<span class="p">}</span>

</code></pre>
</div>
<p><br /></p>

<p>Then I set up a config file as shown in the <a href="https://github.com/michhar/bot-education-ocrbot/blob/master/configuration.js">repository</a> containing my Computer Vision API key (as well as placeholders for the future app id and app password I get after the deployment step - in a followup article TBD).  So, don’t worry about the app id and app password for now.</p>

<p>If you are doing this at home, replace the <code class="highlighter-rouge">process.env.VISION_API_KEY</code> with a string holding your key (this is a separate file I called <code class="highlighter-rouge">configuration.js</code>), see instructions in this <a href="https://github.com/michhar/bot-education-ocrbot/blob/master/LabStart.md">lab file</a>.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1">// Ignore this part for now...</span>
    <span class="na">CHAT_CONNECTOR</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">APP_ID</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">MICROSOFT_APP_ID</span><span class="p">,</span> <span class="c1">//You can obtain an APP ID and PASSWORD here: https://dev.botframework.com/bots/new</span>
        <span class="na">APP_PASSWORD</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">MICROSOFT_APP_PASSWORD</span>
    <span class="p">},</span>
    
    <span class="c1">//  Replace the API_KEY below with yours from the free trial</span>
    <span class="na">COMPUTER_VISION_SERVICE</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">API_URL</span><span class="p">:</span> <span class="s2">"https://api.projectoxford.ai/vision/v1.0/"</span><span class="p">,</span>
        <span class="na">API_KEY</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VISION_API_KEY</span>  <span class="c1">//You can obtain an COGNITIVE SERVICE API KEY: https://www.microsoft.com/cognitive-services/en-us/pricing</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">CONFIGURATIONS</span> <span class="o">=</span> <span class="nx">_config</span><span class="p">;</span>
</code></pre>
</div>
<p><br /></p>

<p>Then back in my <code class="highlighter-rouge">server.js</code> file with the main code I set up my vision OCR functions to read the image text (basically call out the the Computer Vision service with an image url) and then process the text:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="c1">//=========================================================</span>
<span class="c1">// Vision Service</span>
<span class="c1">//=========================================================</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"request"</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">readImageText</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">_readImageText</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">method</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span>
        <span class="na">url</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">CONFIGURATIONS</span><span class="p">.</span><span class="nx">COMPUTER_VISION_SERVICE</span><span class="p">.</span><span class="nx">API_URL</span> <span class="o">+</span> <span class="s2">"ocr/"</span><span class="p">,</span>
        <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">'ocp-apim-subscription-key'</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">CONFIGURATIONS</span><span class="p">.</span><span class="nx">COMPUTER_VISION_SERVICE</span><span class="p">.</span><span class="nx">API_KEY</span><span class="p">,</span>
            <span class="s1">'content-type'</span><span class="p">:</span> <span class="s1">'application/json'</span>
        <span class="p">},</span>
        <span class="na">body</span><span class="p">:</span> <span class="p">{</span><span class="na">url</span><span class="p">:</span> <span class="nx">url</span><span class="p">,</span> <span class="na">language</span><span class="p">:</span> <span class="s2">"en"</span><span class="p">},</span>
        <span class="na">json</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">};</span>

    <span class="nx">request</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>

<span class="p">};</span>

<span class="kd">var</span> <span class="nx">extractText</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">_extractText</span><span class="p">(</span><span class="nx">bodyMessage</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">bodyMessage</span><span class="p">.</span><span class="nx">regions</span> <span class="o">===</span> <span class="s2">"undefined"</span><span class="p">)</span> <span class="k">return</span> <span class="s2">""</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">regs</span> <span class="o">=</span> <span class="nx">bodyMessage</span><span class="p">.</span><span class="nx">regions</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">regs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!==</span> <span class="s2">"undefined"</span> <span class="o">&amp;&amp;</span>
        <span class="nx">regs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">lines</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">text</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>

        <span class="kd">var</span> <span class="nx">lines</span> <span class="o">=</span> <span class="nx">regs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">lines</span><span class="p">;</span>

        <span class="c1">// For all lines in image ocr result</span>
        <span class="c1">//   grab the text in the words array</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">lines</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">words</span> <span class="o">=</span> <span class="nx">lines</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">words</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">words</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">text</span> <span class="o">+=</span> <span class="s2">" "</span> <span class="o">+</span> <span class="nx">words</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">text</span> <span class="o">+</span> <span class="s2">" "</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">text</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="s2">"Sorry, I can't find text in it :( !"</span><span class="p">;</span>
<span class="p">};</span>
</code></pre>
</div>
<p><br /></p>

<p>Finally, we tie it all together in a user dialog:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="c1">//=========================================================</span>
<span class="c1">// Bots Dialogs</span>
<span class="c1">//=========================================================</span>

<span class="nx">bot</span><span class="p">.</span><span class="nx">dialog</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">session</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// Use our url helper method</span>
    <span class="kd">var</span> <span class="nx">extractedUrl</span> <span class="o">=</span> <span class="nx">extractUrl</span><span class="p">(</span><span class="nx">session</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>

    <span class="c1">// Nothing returned?  Ask for an image url again...</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">extractedUrl</span> <span class="o">===</span> <span class="s2">""</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">session</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">"Hello.  I'm an OCRBot.  Please give me an image link and I'll look for words."</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Get a valid url?  Send it off to the Vision API for OCR...</span>
    <span class="nx">readImageText</span><span class="p">(</span><span class="nx">extractedUrl</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">session</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">extractText</span><span class="p">(</span><span class="nx">body</span><span class="p">));</span>
    <span class="p">})</span>
<span class="p">});</span>

</code></pre>
</div>
<p><br /></p>

<p>We could have added a waterfall here to say confirm they want to process this image or perhaps added a built-in prompt that allows uploading an image attachment.  Perhaps in future releases.</p>

<p>Now we test.</p>

<p>On Windows one would double click on the BFEmulator.exe directly and on Mac we use the Mono framework software to run BFEmulator.exe from the command line.  Pretty easy, peasy.</p>

<p>Let’s take this image:</p>

<p><img src="http://www.azquotes.com/picture-quotes/quote-to-consult-the-statistician-after-an-experiment-is-finished-is-often-merely-to-ask-him-ronald-fisher-9-70-13.jpg" alt="Ronald Fisher quote" /><br /></p>

<p>The emulator experience will look a little something like:</p>

<p><img src="/resources/images/ocrbot_on_stats.png" alt="ocrbot local on stats" /><br />
<strong>Command Line Emulator for the Bot Framework - interacting with ocrbot locally on stats</strong></p>

<p>In conclusion, to get started now, check out the github repo and start playing with the code and emulator.  For more instructions check out <a href="https://github.com/michhar/bot-education-ocrbot/blob/master/LabStart.md">this lab</a>.  Chat later!</p>

<p>– <em>Micheleen</em></p>

</p>
      </article>
      <!-- Disqus comments -->
      
    </div>
  </div>
</main>

    <footer class="mdl-mega-footer">
  <div class="mdl-mega-footer--middle-section">

    <div class="mdl-mega-footer--drop-down-section">
      <input class="mdl-mega-footer--heading-checkbox" type="checkbox" checked>
      <h1 class="mdl-mega-footer--heading">INFO</h1>
      <ul class="mdl-mega-footer--link-list">
        <li><a href="mailto:your-email@domain.com">your-email@domain.com</a></li>
        <li><a href="/feed.xml">subscribe via RSS</a></li>
      </ul>
    </div>

    <div class="mdl-mega-footer--drop-down-section">
      <input class="mdl-mega-footer--heading-checkbox" type="checkbox" checked>
      <h1 class="mdl-mega-footer--heading">SOCIAL</h1>
      <ul class="mdl-mega-footer--link-list">
        
        <li>
          <a href="https://github.com/michhar">
            <span class="icon  icon--github">
              <svg viewBox="0 0 16 16">
                <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
              </svg>
            </span>

            <span class="username">michhar</span>
          </a>
        </li>
        
        
        <li>
          <a href="https://twitter.com/rheartpython">
            <span class="icon  icon--twitter">
              <svg viewBox="0 0 16 16">
                <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
              </svg>
            </span>

            <span class="username">rheartpython</span>
          </a>
        </li>
      
	  
      
	  
	  
      </ul>
    </div>

    <div class="mdl-mega-footer--drop-down-section">
      <input class="mdl-mega-footer--heading-checkbox" type="checkbox" checked>
      <h1 class="mdl-mega-footer--heading">ABOUT</h1>
      <ul class="mdl-mega-footer--link-list">
        <li>Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
</li>
      </ul>
    </div>


  </div>

  <div class="mdl-mega-footer--bottom-section">
    <div class="mdl-logo">Waterfalls of Data</div>
    <ul class="mdl-mega-footer--link-list">
      <li><a href="#">Help</a></li>
      <li><a href="#">Privacy & Terms</a></li>
    </ul>
  </div>

</footer>


    </div>
    <!-- /End Layout -->

    <!-- Material Design Lite js Library -->
    <script type="text/javascript" src="https://storage.googleapis.com/code.getmdl.io/1.0.0/material.min.js"></script>
    
    <script rel="javascript" type="text/javascript" src="/js/search.js"></script>
    <script rel="javascript" type="text/javascript">
      superSearch({
        searchFile: '/feed.xml',
        searchSelector: '#js-search', // CSS Selector for search container element.
        inputSelector: '#js-search__input', // CSS selector for <input>
        resultsSelector: '#js-search__results' // CSS selector for results container
      });
    </script>
  </body>

</html>
