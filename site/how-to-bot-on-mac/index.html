



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="A short chatterbot dev story">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.4.0">
    
    
      
        <title>Building an OCR Chat Bot with the Microsoft Bot Framework on my Mac</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.7fb6a6f0.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.792431c1.css">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    
    
    
      <body data-md-color-primary="teal">
    
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Micheleen's Blog" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Micheleen's Blog
              </span>
              <span class="md-header-nav__topic">
                Building an OCR Chat Bot with the Microsoft Bot Framework on my Mac
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    Micheleen's Blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../convolutional-in-layers-and-sequences/" title="Convolutional Neural Networks in Four Deep Learning Frameworks by Example" class="md-nav__link">
      Convolutional Neural Networks in Four Deep Learning Frameworks by Example
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../deploy-with-azureml-cli-boldly/" title="Deploying a Machine Learning Model Easily with Azure ML CLI" class="md-nav__link">
      Deploying a Machine Learning Model Easily with Azure ML CLI
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../cntk-has-feelings-too/" title="The Cognitive Toolkit (CNTK) Understands How You Feel" class="md-nav__link">
      The Cognitive Toolkit (CNTK) Understands How You Feel
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../masks_to_polygons_and_back/" title="Shapely Shapes and OpenCV Visions" class="md-nav__link">
      Shapely Shapes and OpenCV Visions
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../single-artifical-neuron-for-nonlinear-separable-data/" title="On using an Adaline Artificial Neuron for Classification" class="md-nav__link">
      On using an Adaline Artificial Neuron for Classification
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../my-new-static-site-generator-hobby/" title="Overlaying a Website ontop of a GitHub Repository" class="md-nav__link">
      Overlaying a Website ontop of a GitHub Repository
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../data-science-story-part1/" title="On Being a Data Scientist" class="md-nav__link">
      On Being a Data Scientist
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../two-cents-on-python-package-structure/" title="Wading In a Tide Pool of Choices, How to Write a Package in Python?" class="md-nav__link">
      Wading In a Tide Pool of Choices, How to Write a Package in Python?
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ocrbot-gets-attached/" title="OCRBot Gets Attached" class="md-nav__link">
      OCRBot Gets Attached
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../jupyter-and-beaker-make-a-case/" title="The Notebook Superhero -- Is It Always a Contest?" class="md-nav__link">
      The Notebook Superhero -- Is It Always a Contest?
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../javascript-and-python-have-a-party/" title="Javascript and Python Meet through Magic and IPython" class="md-nav__link">
      Javascript and Python Meet through Magic and IPython
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../confusion-matrix-code-revealed/" title="A Simple, Presentable Confusion Matrix with K-means Data" class="md-nav__link">
      A Simple, Presentable Confusion Matrix with K-means Data
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../a-python-flask-webapp-gets-smart/" title="Creating a Smart Python Flask Web App using Azure Machine Learning" class="md-nav__link">
      Creating a Smart Python Flask Web App using Azure Machine Learning
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ocrbot-makes-a-connection/" title="OCRBot Makes a Connection to the Cloud" class="md-nav__link">
      OCRBot Makes a Connection to the Cloud
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
    <a href="./" title="Building an OCR Chat Bot with the Microsoft Bot Framework on my Mac" class="md-nav__link md-nav__link--active">
      Building an OCR Chat Bot with the Microsoft Bot Framework on my Mac
    </a>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../teaching-notes-post/" title="Tips I have Learned by Being a Trainer for a Year" class="md-nav__link">
      Tips I have Learned by Being a Trainer for a Year
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../notebooks1-post/" title="Python for Data Science Goes Into the Wild" class="md-nav__link">
      Python for Data Science Goes Into the Wild
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Building an OCR Chat Bot with the Microsoft Bot Framework on my Mac</h1>
                
                <p><strong>Posted:</strong>  2016-11-07</p>
<p><strong>Command Line Emulator for the Bot Framework - interacting with ocrbot on Shakespeare</strong>
<br><br></p>
<p>UPDATE:  The Command Line Emulator has been replaced with a full-fledged emulator which is cross-platform (info and install <a href="https://github.com/Microsoft/BotFramework-Emulator">here</a>).</p>
<p><strong>tl;dr</strong>: I built a simple OCR bot using the Bot Framework (BF) from Microsoft and the Cognitive Services Computer Vision API.  I chose the Node.js Bot Builder SDK from BF.  I tested with the BF's unix-compatible emulator (black box above).  It was nice and straightforward the whole way through.  All of the instructions are <a href="https://github.com/michhar/bot-education-ocrbot/blob/master/LabStart.md">here</a>, but feel free to keep reading.</p>
<p>There's really almost too much to say about chat bots:  definitions, bot builders, history (<a href="http://venturebeat.com/2016/08/15/a-short-history-of-chatbots-and-artificial-intelligence/">more</a>), warnings and cautionary tales (<a href="http://venturebeat.com/2016/08/15/a-short-history-of-chatbots-and-artificial-intelligence/">more</a>), guidelines, delightful stories, sad stories, etc.  For our purposes, other than a few considerations, I'll sum it up with: they've been around for decades and will be for many more.</p>
<p>However, let's cover some vocabulary to start.</p>
<p>A blog post <a href="http://willschenk.com/bot-design-patterns/?imm_mid=0e50a2&amp;cmp=em-data-na-na-newsltr_20160622">here</a> details the different types of chat bots, progressing from simple to ones that can hold down a conversation.  These are the bot types discussed and an example to illustrate:</p>
<ol>
<li>Notifier - sends a one-way message e.g. <em>ping me with today's weather forecast at the start of the day ("push" bot i.e. bot initiates)</em></li>
<li>Reactor - replies when I send a message, but does not remember anything <em>e.g. send me the weather forecast when I ask for it ("pull bot" i.e. I initiate), but don't remember me or what I ask for</em></li>
<li>Responder - replies and remembers me and my message history e.g. <em>send me today's weather forecast, use my user name on this channel, and remember what cities I choose</em></li>
<li>Conversationalist - replies, remembers me and my message history, knows what service I'm on, if there are others there, and when I come and go e.g. <em>send me today's weather forecast, use my user name on this channel, remember what cities I choose, format it nicely for this channel, and if the conversation is old, archive it and send as email</em></li>
</ol>
<p>Bot builders lower the activation barrier for developing bots and the MS Bot Framework (BF) Bot Builder SDKs give us a wealth of methods for building dialog and user prompts, making the creation of effective waterfalls really easy.  Along with the SDKs, the BF provides free emulator tools, a Windows-compatible desktop app and a Mac OS X / Linux-compatible console app (more information on emulators <a href="https://docs.botframework.com/en-us/tools/bot-framework-emulator/#navtitle">here</a>).</p>
<p>I know you've been waiting to dive into the code, so let's begin...</p>
<p>There are two choices on bot builder functions for testing locally.  We can use the <code>ConsoleConnector</code> which simply and directly allows us to run our Node.js code on the command line.  Using the bot builder SDK our code is pretty concise (see more examples on the Core Concepts page for the BF <a href="https://docs.botframework.com/en-us/node/builder/guides/core-concepts/#navtitle">here</a>):</p>
<p><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;botbuilder&#39;</span><span class="p">);</span>

<span class="c1">// Create a bot and connect it to the console</span>
<span class="kd">var</span> <span class="nx">connector</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">builder</span><span class="p">.</span><span class="nx">ConsoleConnector</span><span class="p">().</span><span class="nx">listen</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">bot</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">builder</span><span class="p">.</span><span class="nx">UniversalBot</span><span class="p">(</span><span class="nx">connector</span><span class="p">);</span>
</pre></div>
<br></p>
<p>Interacting with ocrbot could look like:</p>
<p><img alt="console connector" src="../img/ocrbot_console_connect.png" /><br></p>
<p>It's simple, but we don't get to see the actual JSON that gets passed to the bot and the JSON passed back.  If we want to be able to see the message and also write code that can be used for production later, the Bot Framework Emulator is the way to go.   Note, this is the beginning of my server.js Node.js file - see my <a href="https://github.com/michhar/bot-education-ocrbot">ocrbot github repo</a> for the complete project and code and the included <a href="https://github.com/michhar/bot-education-ocrbot/blob/master/LabStart.md">lab file</a> for more instructions on doing this at home.  We replace  <code>ConsoleConnector</code> with <code>ChatConnector</code>, for a full deployment-compatible setup, as follows:</p>
<p><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">restify</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;restify&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">builder</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;botbuilder&#39;</span><span class="p">);</span>

<span class="c1">// Create bot</span>
<span class="kd">var</span> <span class="nx">connector</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">builder</span><span class="p">.</span><span class="nx">ChatConnector</span><span class="p">(</span><span class="nx">botConnectorOptions</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">bot</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">builder</span><span class="p">.</span><span class="nx">UniversalBot</span><span class="p">(</span><span class="nx">connector</span><span class="p">);</span>

<span class="c1">// Setup Restify Server</span>
<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">restify</span><span class="p">.</span><span class="nx">createServer</span><span class="p">();</span>

<span class="c1">// Handle Bot Framework messages</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/api/messages&#39;</span><span class="p">,</span> <span class="nx">connector</span><span class="p">.</span><span class="nx">listen</span><span class="p">());</span>

<span class="c1">// Serve a static web page - for testing deployment</span>
<span class="nx">server</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="sr">/.*/</span><span class="p">,</span> <span class="nx">restify</span><span class="p">.</span><span class="nx">serveStatic</span><span class="p">({</span>
    <span class="s1">&#39;directory&#39;</span><span class="o">:</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
    <span class="s1">&#39;default&#39;</span><span class="o">:</span> <span class="s1">&#39;index.html&#39;</span>
<span class="p">}));</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">port</span> <span class="o">||</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">3978</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;%s listening to %s&#39;</span><span class="p">,</span> <span class="nx">server</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">server</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span> 
<span class="p">});</span>
</pre></div>
<br></p>
<p>One of the major reasons I used github to host this project is that (and outlined in a later blog, TBD) it afforded me the ability to do a continuous deployment directly from the repo.  Any change I push up, immediately reflects in my bot on whichever channel I'm on - it was actually pretty astonishing to see a quick typo fix show up so immediately when chatting to my bot at the same time as pushing up the change.  But I'll save this for the deployment article to come.</p>
<p>I've always been a fan of command terminals, so even on a Windows machine I'd probably choose to download and use the BF Command Terminal Emulator (download instructions are <a href="https://docs.botframework.com/en-us/tools/bot-framework-emulator/#mac-and-linux-support-using-command-line-emulator">here</a>).  Honestly, I enjoy the simplicity and control a command prompt affords.  And now I can develop bots in the <em>exact</em> same way agnostic of OS.</p>
<p>So, I decided to create a bot I could give image links to and if there was text in the picture it would reply with that text.  Pretty simple and straightforward since I knew about the free subscriptions to Microsoft Cognitive Services and in particular the Vision APIs.  I went to the Cognitive Services main page and clicked on My Account and signed up (or I could have signed up <a href="https://www.microsoft.com/cognitive-services/en-US/sign-up?ReturnUrl=/cognitive-services/en-us/subscriptions">this way</a> with MS, github, or LinkedIn accounts).  After that I had a secret key for the service.  Now to splice that into my bot.</p>
<p>So, I borrowed much of my code from Samuele Resca's <a href="https://samueleresca.net/2016/10/build-universal-bot-using-nodejs/">blog post</a> (excellent blog, btw).  I placed these helper methods in with the server.js code above:</p>
<p><div class="highlight"><pre><span></span><span class="c1">//=========================================================</span>
<span class="c1">// URL Helpers</span>
<span class="c1">//=========================================================</span>


<span class="kd">var</span> <span class="nx">extractUrl</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">_extractUrl</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">type</span> <span class="o">!==</span> <span class="s2">&quot;message&quot;</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">message</span><span class="p">.</span><span class="nx">attachments</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span>
        <span class="o">&amp;&amp;</span> <span class="nx">message</span><span class="p">.</span><span class="nx">attachments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">message</span><span class="p">.</span><span class="nx">attachments</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">contentUrl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">message</span><span class="p">.</span><span class="nx">text</span> <span class="o">!==</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_findUrl</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">text</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="p">};</span>


<span class="kd">function</span> <span class="nx">_findUrl</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">source</span> <span class="o">=</span> <span class="p">(</span><span class="nx">text</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">matchArray</span><span class="p">;</span>

    <span class="c1">// Regular expression to find FTP, HTTP(S) and email URLs.</span>
    <span class="kd">var</span> <span class="nx">regexToken</span> <span class="o">=</span> <span class="sr">/(((http|https?):\/\/)[\-\w@:%_\+.~#?,&amp;\/\/=]+)/g</span><span class="p">;</span>

    <span class="c1">// Iterate through any URLs in the text.</span>
    <span class="k">if</span> <span class="p">((</span><span class="nx">matchArray</span> <span class="o">=</span> <span class="nx">regexToken</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">source</span><span class="p">))</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">matchArray</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="k">return</span> <span class="nx">token</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<br></p>
<p>Then I set up a config file as shown in the <a href="https://github.com/michhar/bot-education-ocrbot/blob/master/configuration.js">repository</a> containing my Computer Vision API key (as well as placeholders for the future app id and app password I get after the deployment step - in a followup article TBD).  So, don't worry about the app id and app password for now.</p>
<p>If you are doing this at home, replace the <code>process.env.VISION_API_KEY</code> with a string holding your key (this is a separate file I called <code>configuration.js</code>), see instructions in this <a href="https://github.com/michhar/bot-education-ocrbot/blob/master/LabStart.md">lab file</a>.</p>
<p><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1">// Ignore this part for now...</span>
    <span class="nx">CHAT_CONNECTOR</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">APP_ID</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">MICROSOFT_APP_ID</span><span class="p">,</span> <span class="c1">//You can obtain an APP ID and PASSWORD here: https://dev.botframework.com/bots/new</span>
        <span class="nx">APP_PASSWORD</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">MICROSOFT_APP_PASSWORD</span>
    <span class="p">},</span>

    <span class="c1">//  Replace the API_KEY below with yours from the free trial</span>
    <span class="nx">COMPUTER_VISION_SERVICE</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">API_URL</span><span class="o">:</span> <span class="s2">&quot;https://api.projectoxford.ai/vision/v1.0/&quot;</span><span class="p">,</span>
        <span class="nx">API_KEY</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VISION_API_KEY</span>  <span class="c1">//You can obtain an COGNITIVE SERVICE API KEY: https://www.microsoft.com/cognitive-services/en-us/pricing</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">CONFIGURATIONS</span> <span class="o">=</span> <span class="nx">_config</span><span class="p">;</span>
</pre></div>
<br></p>
<p>Then back in my <code>server.js</code> file with the main code I set up my vision OCR functions to read the image text (basically call out the the Computer Vision service with an image url) and then process the text:</p>
<p><div class="highlight"><pre><span></span><span class="c1">//=========================================================</span>
<span class="c1">// Vision Service</span>
<span class="c1">//=========================================================</span>

<span class="kd">var</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;request&quot;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">readImageText</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">_readImageText</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
        <span class="nx">url</span><span class="o">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">CONFIGURATIONS</span><span class="p">.</span><span class="nx">COMPUTER_VISION_SERVICE</span><span class="p">.</span><span class="nx">API_URL</span> <span class="o">+</span> <span class="s2">&quot;ocr/&quot;</span><span class="p">,</span>
        <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
            <span class="s1">&#39;ocp-apim-subscription-key&#39;</span><span class="o">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">CONFIGURATIONS</span><span class="p">.</span><span class="nx">COMPUTER_VISION_SERVICE</span><span class="p">.</span><span class="nx">API_KEY</span><span class="p">,</span>
            <span class="s1">&#39;content-type&#39;</span><span class="o">:</span> <span class="s1">&#39;application/json&#39;</span>
        <span class="p">},</span>
        <span class="nx">body</span><span class="o">:</span> <span class="p">{</span><span class="nx">url</span><span class="o">:</span> <span class="nx">url</span><span class="p">,</span> <span class="nx">language</span><span class="o">:</span> <span class="s2">&quot;en&quot;</span><span class="p">},</span>
        <span class="nx">json</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">};</span>

    <span class="nx">request</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>

<span class="p">};</span>

<span class="kd">var</span> <span class="nx">extractText</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">_extractText</span><span class="p">(</span><span class="nx">bodyMessage</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">bodyMessage</span><span class="p">.</span><span class="nx">regions</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">regs</span> <span class="o">=</span> <span class="nx">bodyMessage</span><span class="p">.</span><span class="nx">regions</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">regs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span>
        <span class="nx">regs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">lines</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>

        <span class="kd">var</span> <span class="nx">lines</span> <span class="o">=</span> <span class="nx">regs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">lines</span><span class="p">;</span>

        <span class="c1">// For all lines in image ocr result</span>
        <span class="c1">//   grab the text in the words array</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">lines</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">words</span> <span class="o">=</span> <span class="nx">lines</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">words</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">words</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">text</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nx">words</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">text</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">text</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="s2">&quot;Sorry, I can&#39;t find text in it :( !&quot;</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
<br></p>
<p>Finally, we tie it all together in a user dialog:</p>
<p><div class="highlight"><pre><span></span><span class="c1">//=========================================================</span>
<span class="c1">// Bots Dialogs</span>
<span class="c1">//=========================================================</span>

<span class="nx">bot</span><span class="p">.</span><span class="nx">dialog</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">session</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// Use our url helper method</span>
    <span class="kd">var</span> <span class="nx">extractedUrl</span> <span class="o">=</span> <span class="nx">extractUrl</span><span class="p">(</span><span class="nx">session</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>

    <span class="c1">// Nothing returned?  Ask for an image url again...</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">extractedUrl</span> <span class="o">===</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">session</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">&quot;Hello.  I&#39;m an OCRBot.  Please give me an image link and I&#39;ll look for words.&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Get a valid url?  Send it off to the Vision API for OCR...</span>
    <span class="nx">readImageText</span><span class="p">(</span><span class="nx">extractedUrl</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">session</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">extractText</span><span class="p">(</span><span class="nx">body</span><span class="p">));</span>
    <span class="p">})</span>
<span class="p">});</span>
</pre></div>
<br></p>
<p>We could have added a waterfall here to say confirm they want to process this image or perhaps added a built-in prompt that allows uploading an image attachment.  Perhaps in future releases.</p>
<p>Now we test.</p>
<p>On Windows one would double click on the BFEmulator.exe directly and on Mac we use the Mono framework software to run BFEmulator.exe from the command line.  Pretty easy, peasy.</p>
<p>Let's take this image:</p>
<p><img alt="Ronald Fisher quote" src="http://www.azquotes.com/picture-quotes/quote-to-consult-the-statistician-after-an-experiment-is-finished-is-often-merely-to-ask-him-ronald-fisher-9-70-13.jpg" /><br></p>
<p>The emulator experience will look a little something like:</p>
<p><img alt="ocrbot local on stats" src="../img/ocrbot_on_stats.png" /><br>
<strong>Command Line Emulator for the Bot Framework - interacting with ocrbot locally on stats</strong></p>
<p>In conclusion, to get started now, check out the github repo and start playing with the code and emulator.  For more instructions check out <a href="https://github.com/michhar/bot-education-ocrbot/blob/master/LabStart.md">this lab</a>.  Chat later!</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../ocrbot-makes-a-connection/" title="OCRBot Makes a Connection to the Cloud" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                OCRBot Makes a Connection to the Cloud
              </span>
            </div>
          </a>
        
        
          <a href="../teaching-notes-post/" title="Tips I have Learned by Being a Trainer for a Year" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Tips I have Learned by Being a Trainer for a Year
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://github.com/michhar" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/rheartpython" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://linkedin.com/in/micheleenharris" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.ce2ab4bf.js"></script>
      
      <script>app.initialize({version:"0.17.2",url:{base:".."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
    
      
        <script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-86308542-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})});var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})</script>
      
    
  </body>
</html>