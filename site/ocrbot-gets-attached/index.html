



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="A short chatterbot dev story Part">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.4.0">
    
    
      
        <title>OCRBot Gets Attached</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.7fb6a6f0.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.792431c1.css">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    
    
    
      <body data-md-color-primary="teal">
    
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Micheleen's Blog" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Micheleen's Blog
              </span>
              <span class="md-header-nav__topic">
                OCRBot Gets Attached
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    Micheleen's Blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../deploy-with-azureml-cli-boldly/" title="Deploying a Machine Learning Model Easily with Azure ML CLI" class="md-nav__link">
      Deploying a Machine Learning Model Easily with Azure ML CLI
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../cntk-has-feelings-too/" title="The Cognitive Toolkit (CNTK) Understands How You Feel" class="md-nav__link">
      The Cognitive Toolkit (CNTK) Understands How You Feel
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../masks_to_polygons_and_back/" title="Shapely Shapes and OpenCV Visions" class="md-nav__link">
      Shapely Shapes and OpenCV Visions
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../single-artifical-neuron-for-nonlinear-separable-data/" title="On using an Adaline Artificial Neuron for Classification" class="md-nav__link">
      On using an Adaline Artificial Neuron for Classification
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../my-new-static-site-generator-hobby/" title="Overlaying a Website ontop of a GitHub Repository" class="md-nav__link">
      Overlaying a Website ontop of a GitHub Repository
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../data-science-story-part1/" title="On Being a Data Scientist" class="md-nav__link">
      On Being a Data Scientist
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../two-cents-on-python-package-structure/" title="Wading In a Tide Pool of Choices, How to Write a Package in Python?" class="md-nav__link">
      Wading In a Tide Pool of Choices, How to Write a Package in Python?
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        OCRBot Gets Attached
      </label>
    
    <a href="./" title="OCRBot Gets Attached" class="md-nav__link md-nav__link--active">
      OCRBot Gets Attached
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#whats-the-wow-factor" title="What's the wow factor?" class="md-nav__link">
    What's the wow factor?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reintroducing-ocr" title="(Re)Introducing OCR" class="md-nav__link">
    (Re)Introducing OCR
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-has-ocrbots-code-changed" title="How has OCRBot's code changed" class="md-nav__link">
    How has OCRBot's code changed
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#from-the-original-ocrbot" title="From the original OCRBot" class="md-nav__link">
    From the original OCRBot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-promise" title="A Promise..." class="md-nav__link">
    A Promise...
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-end-of-this-chapter-and-ocrbots-next-adventure" title="The end of this chapter and OCRBot's next adventure" class="md-nav__link">
    The end of this chapter and OCRBot's next adventure
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../jupyter-and-beaker-make-a-case/" title="The Notebook Superhero -- Is It Always a Contest?" class="md-nav__link">
      The Notebook Superhero -- Is It Always a Contest?
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../javascript-and-python-have-a-party/" title="Javascript and Python Meet through Magic and IPython" class="md-nav__link">
      Javascript and Python Meet through Magic and IPython
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../confusion-matrix-code-revealed/" title="A Simple, Presentable Confusion Matrix with K-means Data" class="md-nav__link">
      A Simple, Presentable Confusion Matrix with K-means Data
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../a-python-flask-webapp-gets-smart/" title="Creating a Smart Python Flask Web App using Azure Machine Learning" class="md-nav__link">
      Creating a Smart Python Flask Web App using Azure Machine Learning
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ocrbot-makes-a-connection/" title="OCRBot Makes a Connection to the Cloud" class="md-nav__link">
      OCRBot Makes a Connection to the Cloud
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../how-to-bot-on-mac/" title="Building an OCR Chat Bot with the Microsoft Bot Framework on my Mac" class="md-nav__link">
      Building an OCR Chat Bot with the Microsoft Bot Framework on my Mac
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../teaching-notes-post/" title="Tips I have Learned by Being a Trainer for a Year" class="md-nav__link">
      Tips I have Learned by Being a Trainer for a Year
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../notebooks1-post/" title="Python for Data Science Goes Into the Wild" class="md-nav__link">
      Python for Data Science Goes Into the Wild
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#whats-the-wow-factor" title="What's the wow factor?" class="md-nav__link">
    What's the wow factor?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reintroducing-ocr" title="(Re)Introducing OCR" class="md-nav__link">
    (Re)Introducing OCR
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-has-ocrbots-code-changed" title="How has OCRBot's code changed" class="md-nav__link">
    How has OCRBot's code changed
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#from-the-original-ocrbot" title="From the original OCRBot" class="md-nav__link">
    From the original OCRBot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-promise" title="A Promise..." class="md-nav__link">
    A Promise...
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-end-of-this-chapter-and-ocrbots-next-adventure" title="The end of this chapter and OCRBot's next adventure" class="md-nav__link">
    The end of this chapter and OCRBot's next adventure
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>OCRBot Gets Attached</h1>
                
                <p><img alt="" src="../img/bot_part3/knn_mharris_letters.jpg" /></p>
<p><a href="https://en.wikipedia.org/wiki/TL;DR"><strong>tl;dr</strong></a>:  Chatterbots are trending bigtime!  Here, we continue the story of OCRBot, a word recognizing chatbot.  OCRBot's new ability to get image text from attachments is revealed (adding to it's existing ability to take image web links).  So, we can snap a picture of some text and OCRbot finds the words.  This could lead us into even more exciting realms like text to speech or translation.</p>
<p><strong>Posted:</strong>  2017-03-01</p>
<p align="right"><b>For OCR, commonly a k-nearest neighbors classifier is used for character recognition</b></p>

<p>For the first two stories, see <a href="https://michhar.github.io/posts/how-to-bot-on-mac">Part 1</a> and <a href="https://michhar.github.io/posts/ocrbot-makes-a-connection">Part 2</a>.</p>
<h3 id="whats-the-wow-factor">What's the wow factor?</h3>
<p>Have you ever just wanted the text extracted from, perhaps a page in a book or a funny comic that's sitting around in an image?  Or maybe it'd be helpful to take a snapshot of a menu item wherein the font is a bit too small or you forgot your reading glasses, however, it's easy to read on your phone as plain text. Now, if you send the OCRBot an image (jpeg, png, gif, bmp are its known formats), on one of its supported conversational platforms like Skype or Slack, you'll get that text you crave.</p>
<p><img alt="ocr bot with my coaster" src="../img/bot_part3/ocrbot_skype.jpg" /></p>
<p align="right"><b>OCRBot on Skype - using a photo I just took of my favorite coaster sitting on my coffee table currently</b></p>

<p>This is not only fun and useful it could be the precursor to adding text to speech, or TTS, to the bot itself as we've got a Cognitive Servies API for that (Bing Speech).  You can, of course at this point even, pipe this text into one of your TTS apps already on your device.</p>
<h3 id="reintroducing-ocr">(Re)Introducing OCR</h3>
<p>OCR, or optical character recognition, is the electronic or mechnanical recognition of text in images and the conversion into machine-encoded representaions.  The text could be handwritten, typed or printed.  The data is an image such as scanned passports or financial data, business cards, postal mail, or any document as an image that someone wishes to digitize.</p>
<p>Sometimes, OCR uses the human mind as the intelligence algorithms.  An example is the use of reCAPTCHA as a crowdsourcing effort for a two-fold purpose:  verification that the entity logging in somewhere is not a bot and crowdsourcing the recognition of hard to read text for the archiving of say 13 million articles from the NY Times starting with articles from 1851 which was accomplished in 2011 along with all of the books on Google Books.</p>
<p>OCR is performed through <strong><a href="https://en.wikipedia.org/wiki/Pattern_recognition">pattern recognition</a></strong> with components often pulled from AI and computer vision.  The process usually takes the form of:  pre-processing (fixing skew, noise reduction, conversion to black-and-white, and the like) - see figure below; character or word recognition through feature extraction and, often, a k-nearest neighbors classification (see figure below), one of the simplest of ML algorithms; post-processing such as validation through seeing co-occurrences of words (words that usually go together like "ice cream" instead of "ice pizza").  See the <a href="https://en.wikipedia.org/wiki/Optical_character_recognition">Wikipedia article on OCR</a> for more.</p>
<p>In the Cognitive Services OCR, we have the idea of word detection within bounding boxes, combining pre-processing and several ML algorithms such as the feature extraction mentioned above, another set of algorithms for classification (including convolutional neural networks) and validation through simillar means as above, plus using a vocabulary and other techniques.</p>
<p>Pre-processing example:</p>
<p><img alt="pre-processing example" src="../img/bot_part3/pre_process.jpg" /></p>
<p align="right"><b>An example of image pre-processing for character recognition:  fixing skew, binarisation, despekling, and line removal</b></p>

<p>k-nearest neighbor example:</p>
<p><img alt="k-nearest neighbors example" src="../img/bot_part3/knn_mharris_letters.jpg" /></p>
<p align="right"><b>Classifying the orange letter as a blue D or green P.  Note, that if k is 3, the orange letter is classified as a blue D, but with a k of 7 it is classified as a green P.  The structure of the data can cause for a tricky problem in k-NN</b></p>

<p>Nowadays, especially on devices like smart phones, the OCR model used to do this conversion to text is done in the cloud through an API.  This is how the Computer Vision API for OCR under the Cognitive Services umbrealla on Azure gets it done.</p>
<p>And for those who like a little history, note that OCR was known to be used in devices as early as 1914 with Emanuel Goldberg's invention of a machine that could read characters and convert them into standard <a href="https://en.wikipedia.org/wiki/Telegraph_code">telegraph code</a> like Morse code (see <a href="https://en.wikipedia.org/wiki/Optical_character_recognition">this Wikipedia</a> article for more history).  Skip ahead to today and we have optical word recognition (commonly called OCR) used for typewritten text and others like intelligent character recognition (ICR) for handwritten or cursive text.</p>
<h3 id="how-has-ocrbots-code-changed">How has OCRBot's code changed</h3>
<h4 id="from-the-original-ocrbot">From the original OCRBot</h4>
<p>OCRBot began with the ability to take a web link of an image with text and give us back the actual text in <a href="https://michhar.github.io/posts/how-to-bot-on-mac">Post 1</a>.  Now we've updated OCRBot quite a bit to also accept images as attachments to the conversation.</p>
<p>Simply check out the <code>server.js</code> at github link <a href="https://github.com/michhar/bot-education-ocrbot">here</a> for the new changes to OCRBot of which there are quite a few.  Certainly an overhaul of sorts, one of which was the incorporation of promises...</p>
<h4 id="a-promise">A Promise...</h4>
<p>What is a Promise?  Let's start with a promise of a promise that I like (ok, I had to go there) from an article by Marc Harter found <a href="https://strongloop.com/strongblog/promises-in-node-js-an-alternative-to-callbacks/">here</a>.</p>
<blockquote>
<p>Promises are a compelling alternative to callbacks when dealing with asynchronous code. [...] Callbacks are the simplest possible mechanism for asynchronous code in JavaScript. Unfortunately, raw callbacks sacrifice the control flow, exception handling, and function semantics familiar from synchronous code. Promises provide a way to get those things back.</p>
</blockquote>
<p>See <a href="https://en.wikipedia.org/wiki/Parallel_computing">this</a> article if you are unfamiliar with the meaning of asychronous.</p>
<p>Key concepts (don't worry if this doesn't quite make sense yet) of a promise are as follows (paraphrased from info in Harter's article).</p>
<ul>
<li>A <code>promise</code> (one way to think about them), is a value representing an asynchronous operation that is only fufilled once, either being resolved or rejected (we'll see in code soon).</li>
<li><code>then</code>, a reserved word for promises, allows anyone with access to the promise to be able to consume it <em>regardless of if the asynchronous operation is done or not</em>.  One way to think about them is as a function which unwraps the asynchronous operation's result from the promise.  <code>then</code> returns a promise.</li>
<li><code>catch</code> is often used after a <code>then</code>, series of <code>then</code>s, or some nested <code>then</code>s to handle errors both implicitly and explicitly if the ned arises.</li>
<li>We can still use <code>return</code> to model syncrhonous functions by returning a promise or any other value that and then signaling the next <code>then</code>, possibly giving this value to the next <code>onFufilled</code>.</li>
<li><code>onFufilled</code> and <code>onRejected</code> are the callbacks and handlers that <code>then</code> handles to signal what to do with the results of a promise.</li>
</ul>
<p>Here's a simple representation in code of the logic changes a promise provides.</p>
<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nx">readFile</span><span class="p">()</span>
<span class="nx">promise</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">,</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">)</span>
</pre></div>

<p>In this example, <code>readFile</code> does, in fact, need to return a promise.  This object can now be used with any <code>then</code> that has access to the promise.  You'll notice that the <code>then</code> has two bits to it.  If the promise is fufilled in <code>readFile</code> the first (<code>console.log</code>) chunk of code is called, and if rejected, the second chunk is called (<code>console.error</code>).</p>
<p>We can create raw promises in the following way.  In this example, we are using the <code>fs</code> library's <code>readFile</code> method, using <code>reject</code> to pass on the result of the promise in the case of an error, and <code>resolve</code> if it is fufilled or simply not rejected, wrapping all of this up in a function which returns the promise to be used by a <code>then</code>.  Then, the next <code>then</code> that consumes this promise-returning function "unwraps" that logic.</p>
<div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">readFileAsync</span> <span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">encoding</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">encoding</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">reject</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="c1">// rejects the promise with `err` as the reason</span>
      <span class="nx">resolve</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>               <span class="c1">// fulfills the promise with `data` as the value</span>
    <span class="p">})</span>
  <span class="p">})</span>
<span class="p">}</span>
<span class="nx">readFileAsync</span><span class="p">(</span><span class="s1">&#39;myfile.txt&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">,</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">)</span>
</pre></div>

<p>In a similar way, the OCRBot's code now includes promises and this looks like the raw promise above with the clever use of a <code>catch</code> to catch any unhandled errors and give some information back to the app and user.</p>
<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">fileDownload</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span>
                <span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">check</span> <span class="o">=</span> <span class="nx">checkRequiresToken</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
                    <span class="k">if</span>  <span class="p">(</span><span class="nx">check</span><span class="o">==</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">resolve</span><span class="p">(</span><span class="nx">requestWithToken</span><span class="p">(</span><span class="nx">attachment</span><span class="p">.</span><span class="nx">contentUrl</span><span class="p">));</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="nx">resolve</span><span class="p">(</span><span class="nx">request_promise</span><span class="p">(</span><span class="nx">attachment</span><span class="p">.</span><span class="nx">contentUrl</span><span class="p">));</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">);</span>

            <span class="nx">fileDownload</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span>
                <span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>

                <span class="nx">readImageText</span><span class="p">(</span><span class="nx">response</span><span class="p">,</span> <span class="nx">attachment</span><span class="p">.</span><span class="nx">contentType</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">session</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">extractText</span><span class="p">(</span><span class="nx">body</span><span class="p">));</span>
                <span class="p">});</span>

                <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Error with attachment: &#39;</span><span class="p">,</span> <span class="p">{</span> 
                        <span class="nx">statusCode</span><span class="o">:</span> <span class="nx">err</span><span class="p">.</span><span class="nx">statusCode</span><span class="p">,</span> 
                        <span class="nx">message</span><span class="o">:</span> <span class="nx">err</span> <span class="p">});</span>
                        <span class="nx">session</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">&quot;Error with attachment or reading image with %s&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
            <span class="p">});</span>
</pre></div>

<p>Promises are quite amazing, leading to resolving many issues around Node.js code such as too many nested callbacks (aka "callback hell") and clean error handling.  I hope you got a bit of that enthusiasm from reading through this section.</p>
<h3 id="the-end-of-this-chapter-and-ocrbots-next-adventure">The end of this chapter and OCRBot's next adventure</h3>
<p>I'm actually not sure what will be in store for OCRBot next.  There are so many fantastic "smarts" we could add or clever functionality.  It'll have to wait and be revealed when OCRBot returns to this blog.</p>
<p><img alt="happy bot" src="../img/bot_part3/ocrbot_attached.jpg" /></p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../two-cents-on-python-package-structure/" title="Wading In a Tide Pool of Choices, How to Write a Package in Python?" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Wading In a Tide Pool of Choices, How to Write a Package in Python?
              </span>
            </div>
          </a>
        
        
          <a href="../jupyter-and-beaker-make-a-case/" title="The Notebook Superhero -- Is It Always a Contest?" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                The Notebook Superhero -- Is It Always a Contest?
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://github.com/michhar" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/rheartpython" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://linkedin.com/in/micheleenharris" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.ce2ab4bf.js"></script>
      
      <script>app.initialize({version:"0.17.2",url:{base:".."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
    
      
        <script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-86308542-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})});var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})</script>
      
    
  </body>
</html>